# 使用指南

FinchBot 提供了丰富的命令行界面 (CLI) 来与智能体进行交互。本文档详细介绍所有可用的命令和交互方式。

## 1. 启动与基本交互

### 启动 FinchBot

```bash
finchbot chat
```

或者使用 `uv run`：

```bash
uv run finchbot chat
```

### 指定会话

您可以指定一个会话 ID 来继续之前的对话或开始新对话：

```bash
finchbot chat --session "project-alpha"
```

如果未指定，系统会自动加载最近一次活跃的会话。

### 交互模式

进入聊天界面后，您可以直接输入自然语言与 Agent 对话。

- **输入**: 直接输入文字并回车。
- **换行**: 目前 CLI 为单行输入模式，长文本建议分段发送或使用文件读取工具。
- **退出**: 输入 `exit`, `quit`, `:q` 或 `q` 退出程序。

---

## 2. 聊天命令 (Slash Commands)

在聊天界面中，以 `/` 开头的输入被视为特殊命令。

### `/history`

查看当前会话的历史消息记录。

- **功能**: 显示从会话开始至今的所有消息（用户、AI、工具调用）。
- **用途**: 回顾上下文，或查看消息索引（用于回滚）。

### `/rollback <index> [new_session_id]`

时光倒流：将对话状态回滚到指定的消息索引处。

- **参数**:
    - `<index>`: 目标消息的索引号（可通过 `/history` 查看）。
    - `[new_session_id]` (可选): 如果提供，将创建一个新的分支会话，原会话保持不变。如果不提供，将覆盖当前会话。
- **示例**:
    - `/rollback 5`: 回滚到第 5 条消息之后的状态（删除索引 > 5 的所有消息）。
    - `/rollback 5 branch-b`: 基于第 5 条消息的状态创建名为 `branch-b` 的新会话。

### `/back <n>`

撤销最近的 n 条消息。

- **参数**:
    - `<n>`: 要撤销的消息数量。
- **示例**:
    - `/back 1`: 撤销最后一条消息（通常用于纠正刚才发错的内容）。
    - `/back 2`: 撤销最后的一轮对话（用户提问 + AI 回复）。

---

## 3. 会话管理界面

FinchBot 提供了一个全屏的交互式会话管理器。

### 进入管理器

直接运行会话管理命令：

```bash
finchbot sessions
```

或者不带任何参数启动 `finchbot chat`，且没有历史会话时，也会自动进入。

### 操作指南

- **↑ / ↓**: 导航选择会话。
- **Enter**: 进入选中的会话。
- **r**: 重命名当前选中的会话。
- **d**: 删除当前选中的会话。
- **n**: 创建新会话。
- **q**: 退出管理器。

---

## 4. 配置管理器

FinchBot 提供了交互式配置管理界面。

### 进入配置管理器

```bash
finchbot config
```

这将启动交互式界面，用于配置 API 密钥、默认模型和其他设置。

---

## 5. 模型管理

### 下载嵌入模型

下载本地记忆存储所需的嵌入模型：

```bash
finchbot models download
```

系统会自动检测网络环境并选择最佳的镜像源。

---

## 6. 全局选项

`finchbot` 命令行支持以下全局选项：

- `--help`: 显示帮助信息。
- `--version`: 显示版本号。
- `--verbose` / `-v`: 启用详细日志（调试模式）。
- `--quiet` / `-q`: 静默模式，只输出错误信息。

**示例**:

```bash
# 以调试模式启动，查看详细的思维过程和网络请求
finchbot chat -v
```

### 命令速查表

| 命令 | 说明 |
|------|------|
| `finchbot chat` | 启动交互式聊天会话 |
| `finchbot chat --session <id>` | 启动/继续指定会话 |
| `finchbot sessions` | 打开会话管理器 |
| `finchbot config` | 打开配置管理器 |
| `finchbot models download` | 下载嵌入模型 |
| `finchbot version` | 显示版本信息 |
